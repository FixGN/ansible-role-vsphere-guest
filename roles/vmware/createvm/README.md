# Ansible role: Create new VM from template

## Требования:
    * OS: CentOS 7
    * Ansible version 2.3 and higher

## Переменные host'ов (разруливаются либо в host_vars, либо в group_vars)
### Connecting settings
    * VCenterHostname - Hostname сервера VSphere;
    * VCenterUsername - Пользователь VSphere;
    * VCenterPassword - Пароль пользователя VSphere;

### VM settings
    * Datacenter - Название датацентра, в который будет развёрнута машинка;
    * Cluster - Кластер, на который мы будем разворачивать машинку;
    * ResourcePool - Пул ресурсов, из которого будут браться ресурсы для нашей VM;
    * VMName - Название нашей машинки, с которым она будет отображаться в VSphere;
    * Domain - Доменная зона, которая будет использоваться машиной для поиска;
    * Hostname - Hostname машинки. Обязательно указывается без доменна (VSphere ругается на точки);
    * GuestID - ID гостевой машины, по которой наш VSphere ориентируется в том, какая ОС установлена на виртуальной машине;
    * VMFolder - Папка в VSphere, в которую будет добавлена наша VM;
    * VMTemplate - Шаблон, который будет использоваться для создания VM;
    * Datastore - Datastore, на котором расположатся наши диски и сама VM;

### Hardware settings
    * HDDList - В данном списке указываются диски, которые должны быть у нашей машины;
    - size_gb - Размер нашего диска в GB;
    - type - Тип диска;
    - datastore - Datastore, на котором данный диск будет храниться;
    * RAMSize - Размер ОЗУ в MB;
    * CPU - Количество виртуальных CPU;

### Network settings
    * Vlan - Название VLAN'а, к которому мы подключаем нашу машинку;
    * IPAddress - IP адрес машины;
    * Netmask - Маска сети;
    * Gateway - Шлюз сети;
    * DNSServers - Переменная, содержащая список DNS серверов для машины

## Описание
    Данная роль позволяет нам создавать машинки в автоматическом режиме. Для её применения надо обязательно указывать, что Ansible должен производить все действия локально и не проверять доступность машины. Пример playbook'а можно посмотреть в файле createvm.yml, который является полностью рабочим.
    Перед работой с ним, обязательно переназначьте конфигурацию для наших машинок в host_vars, т.к. все не указанные параметры будут использоваться из defaults, заданных в нашей роли.
    Ещё один момент, на который стоит обратить внимание - файл cloud_login.yml. Данный файл служит для удобного использования своей УЗ для VSphere, а так же добавлен в gitignore (дабы не бояться, что он улетит в GIT). Пример его заполнения можно посмотреть в файле cloud_login_example.yml, который находится в корне.

## Известные проблемы
    * Domain надо указывать в Customization, в Network не работает;
    * Не работает добавление DNS-серверов в созданные виртуалки. Работает только при создании с нуля;
    * Указывать имя Datastore надо без пути, иначе выбирается тот, который захочется VMWare;
